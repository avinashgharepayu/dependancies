'use strict';

module.exports = function(mongoose) {
    var SchemaType = mongoose.SchemaType,
        Schema = mongoose.Schema;

    function SchemaNumber (key, options) {
        SchemaType.call(this, key, options, 'Number');
    }
    SchemaNumber.schemaName = 'Number';
    SchemaNumber.prototype = Object.create( Schema.Types.Number.prototype );
    SchemaNumber.prototype.constructor = SchemaNumber;

    SchemaNumber.prototype.roundto = function (value) {
        return this.set(function (v, self) {
            if ('number' !== typeof v) v = self.cast(v);
            if (v) return Math.round(v * Math.pow(10, value)) / Math.pow(10, value);
            return v;
        });
    };

    Schema.Types.Number = SchemaNumber;
    mongoose.Types.Number = mongoose.mongo.Number;
};